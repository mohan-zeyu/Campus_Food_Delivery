<!--pages/delivery-order-detail/index.wxml-->
<view class="delivery-order-page" wx:if="{{!loading}}">

  <view class="status-banner">
    <view class="status-text">{{order.status === 'paid' ? 'å¾…æ¥å•' : order.status === 'accepted' ? 'å‡†å¤‡å–é¤' : order.status === 'picking_up' ? 'å–é¤ä¸­' : order.status === 'in_transit' ? 'é…é€ä¸­' : 'å·²é€è¾¾'}}</view>
  </view>

  <view class="info-card card">
    <view class="card-title">é…é€åœ°å€</view>
    <view class="addr-detail text-bold">ğŸ“ {{order.delivery_address.building}} {{order.delivery_address.room}}</view>
    <view class="addr-contact text-secondary text-sm mt-8">{{order.delivery_address.contact}} {{order.delivery_address.phone}}</view>
  </view>

  <view class="info-card card">
    <view class="card-title">{{order.merchant_name}}</view>
    <view wx:for="{{order.items}}" wx:key="product_id" class="item-row row-between">
      <view class="text-secondary">{{item.product_name}} x{{item.quantity}}</view>
      <view>Â¥{{item.subtotal/100}}</view>
    </view>
  </view>

  <view class="fee-card card">
    <view class="row-between">
      <view class="text-secondary">é…é€æ”¶ç›Š</view>
      <view class="text-primary text-bold">+Â¥{{order.delivery_fee/100}}</view>
    </view>
  </view>

  <!-- é€è¾¾å‡­è¯ -->
  <view class="proof-card card" wx:if="{{order.status === 'in_transit' || (order.status === 'delivered' && proofImage)}}">
    <view class="card-title">é€è¾¾å‡­è¯</view>

    <block wx:if="{{proofImage}}">
      <view class="proof-img-wrap">
        <image class="proof-img" src="{{proofImage}}" mode="aspectFill" bindtap="onPreviewProof" />
      </view>
      <view class="proof-retake" bindtap="onChooseProof" wx:if="{{order.status === 'in_transit'}}">é‡æ–°æ‹æ‘„</view>
    </block>

    <block wx:elif="{{order.status === 'in_transit'}}">
      <button class="proof-btn" bindtap="onChooseProof">ğŸ“· æ‹æ‘„é€è¾¾å‡­è¯</button>
    </block>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-bar">
    <button wx:if="{{order.status === 'paid'}}"
      class="action-btn btn-primary" loading="{{actionLoading}}" bindtap="onAccept">æ¥å•</button>
    <button wx:elif="{{order.status === 'accepted'}}"
      class="action-btn btn-primary" bindtap="onPickUp">å·²å–é¤</button>
    <button wx:elif="{{order.status === 'picking_up'}}"
      class="action-btn btn-primary" bindtap="onDispatch">å¼€å§‹é…é€</button>
    <button wx:elif="{{order.status === 'in_transit'}}"
      class="action-btn btn-primary" bindtap="onDeliver">ç¡®è®¤é€è¾¾</button>
    <view wx:elif="{{order.status === 'delivered'}}" class="action-done">å·²å®Œæˆé…é€ âœ“</view>
  </view>

</view>
<view wx:else class="loading-wrap">åŠ è½½ä¸­...</view>
