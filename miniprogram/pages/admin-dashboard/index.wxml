<!--pages/admin-dashboard/index.wxml-->
<view class="admin-dashboard-page" wx:if="{{!loading && stats}}">
  <view class="stats-banner">
    <view class="stats-title">ä»Šæ—¥æ¦‚è§ˆ</view>
    <view class="stats-grid">
      <view class="stat-item">
        <view class="stat-num">{{stats.todayOrders}}</view>
        <view class="stat-label">ä»Šæ—¥è®¢å•</view>
      </view>
      <view class="stat-item">
        <view class="stat-num">Â¥{{stats.todayRevenue/100}}</view>
        <view class="stat-label">ä»Šæ—¥è¥æ”¶</view>
      </view>
      <view class="stat-item">
        <view class="stat-num">{{stats.activeMerchants}}</view>
        <view class="stat-label">è¥ä¸šå•†å®¶</view>
      </view>
      <view class="stat-item">
        <view class="stat-num">{{stats.activeDelivery}}</view>
        <view class="stat-label">é…é€å‘˜</view>
      </view>
    </view>
  </view>

  <!-- é«˜çº§ç»Ÿè®¡ -->
  <view class="adv-section" wx:if="{{advStats}}">
    <!-- å–æ¶ˆç‡ -->
    <view class="adv-card card">
      <view class="adv-title text-bold">è¿‘7å¤©è®¢å•æ¦‚å†µ</view>
      <view class="row-between mt-16">
        <view class="adv-stat">
          <view class="adv-stat-num">{{advStats.totalCount}}</view>
          <view class="adv-stat-label text-secondary text-sm">æ€»è®¢å•</view>
        </view>
        <view class="adv-stat">
          <view class="adv-stat-num">{{advStats.cancelledCount}}</view>
          <view class="adv-stat-label text-secondary text-sm">å–æ¶ˆæ•°</view>
        </view>
        <view class="adv-stat">
          <view class="adv-stat-num cancel-rate">{{advStats.cancelRate}}%</view>
          <view class="adv-stat-label text-secondary text-sm">å–æ¶ˆç‡</view>
        </view>
      </view>
    </view>

    <!-- æ¯æ—¥è¶‹åŠ¿ -->
    <view class="adv-card card" wx:if="{{advStats.dailyTrend.length > 0}}">
      <view class="adv-title text-bold">æ¯æ—¥è®¢å•è¶‹åŠ¿</view>
      <view class="trend-list mt-16">
        <view class="trend-row row-between" wx:for="{{advStats.dailyTrend}}" wx:key="date">
          <view class="trend-date">{{item.date}}</view>
          <view class="trend-bar-wrap flex-1">
            <view class="trend-bar" style="width: {{item.orders > 0 && advStats.totalCount > 0 ? (item.orders / advStats.totalCount * 100) : 2}}%"></view>
          </view>
          <view class="trend-num">{{item.orders}}å•</view>
        </view>
      </view>
    </view>

    <!-- é«˜å³°æ—¶æ®µ -->
    <view class="adv-card card" wx:if="{{advStats.peakHours.length > 0}}">
      <view class="adv-title text-bold">é«˜å³°æ—¶æ®µ TOP5</view>
      <view class="peak-list mt-16">
        <view class="peak-row row-between" wx:for="{{advStats.peakHours}}" wx:key="hour">
          <view class="peak-hour">{{item.hour}}:00</view>
          <view class="peak-bar-wrap flex-1">
            <view class="peak-bar" style="width: {{advStats.peakHours[0].count > 0 ? (item.count / advStats.peakHours[0].count * 100) : 0}}%"></view>
          </view>
          <view class="peak-count">{{item.count}}å•</view>
        </view>
      </view>
    </view>

    <!-- çƒ­é—¨å•†å®¶ -->
    <view class="adv-card card" wx:if="{{advStats.popularMerchants.length > 0}}">
      <view class="adv-title text-bold">çƒ­é—¨å•†å®¶ TOP5</view>
      <view class="popular-list mt-16">
        <view class="popular-row row-between" wx:for="{{advStats.popularMerchants}}" wx:key="name">
          <view class="popular-rank">{{index + 1}}</view>
          <view class="popular-name flex-1">{{item.name}}</view>
          <view class="popular-count text-secondary">{{item.count}}å•</view>
        </view>
      </view>
    </view>
  </view>

  <view class="menu-group card">
    <view class="menu-item row-between" bindtap="onUsers"><view>ğŸ‘¥ ç”¨æˆ·ç®¡ç†</view><view>â€º</view></view>
    <view class="divider"></view>
    <view class="menu-item row-between" bindtap="onMerchants"><view>ğŸª å•†å®¶ç®¡ç†</view><view>â€º</view></view>
    <view class="divider"></view>
    <view class="menu-item row-between" bindtap="onOrders"><view>ğŸ“‹ è®¢å•ç®¡ç†</view><view>â€º</view></view>
    <view class="divider"></view>
    <view class="menu-item row-between" bindtap="onNotices"><view>ğŸ“¢ å…¬å‘Šç®¡ç†</view><view>â€º</view></view>
  </view>
</view>
<view wx:else class="loading-wrap">åŠ è½½ä¸­...</view>
