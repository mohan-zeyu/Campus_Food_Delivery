<!--pages/order-detail/index.wxml-->
<view class="order-detail-page" wx:if="{{!loading}}">

  <!-- 状态头部 -->
  <view class="status-header">
    <view class="status-text">{{order.statusLabel}}</view>
    <view class="order-no text-sm">订单号：{{order.order_no}}</view>
  </view>

  <!-- 配送地址 -->
  <view class="info-card card">
    <view class="card-title">配送地址</view>
    <view class="addr-info">
      <view class="text-bold">{{order.delivery_address.building}} {{order.delivery_address.room}}</view>
      <view class="text-secondary text-sm mt-8">{{order.delivery_address.contact}} {{order.delivery_address.phone}}</view>
    </view>
  </view>

  <!-- 商品明细 -->
  <view class="info-card card">
    <view class="card-title">{{order.merchant_name}}</view>
    <view class="order-item row" wx:for="{{order.items}}" wx:key="product_id">
      <image class="item-img" src="{{item.product_image}}" mode="aspectFill"/>
      <view class="item-info flex-1">
        <view class="item-name">{{item.product_name}}</view>
        <view class="item-remarks text-secondary text-sm" wx:if="{{item.remarks}}">{{item.remarks}}</view>
      </view>
      <view class="item-qty text-secondary">x{{item.quantity}}</view>
      <view class="item-price">¥{{item.unit_price/100}}</view>
    </view>
  </view>

  <!-- 配送时间 -->
  <view class="info-card card" wx:if="{{order.delivery_time}}">
    <view class="fee-row row-between">
      <view class="text-secondary">配送时间</view>
      <view>{{order.delivery_time}}</view>
    </view>
  </view>

  <!-- 费用 -->
  <view class="info-card card">
    <view class="fee-row row-between"><view class="text-secondary">商品金额</view><view>¥{{order.items_total/100}}</view></view>
    <view class="fee-row row-between"><view class="text-secondary">包装费</view><view>¥{{order.packaging_fee/100}}</view></view>
    <view class="fee-row row-between"><view class="text-secondary">配送费</view><view>¥{{order.delivery_fee/100}}</view></view>
    <view class="divider mt-16 mb-16"></view>
    <view class="fee-row row-between text-bold"><view>实付</view><view class="price">¥{{order.total_amount/100}}</view></view>
  </view>

  <!-- 操作按钮 -->
  <view class="action-bar" wx:if="{{canCancel || canConfirm || canReview || canRush}}">
    <view wx:if="{{canRush}}" class="action-btn btn-ghost" bindtap="onRushOrder">催单</view>
    <view wx:if="{{canCancel}}" class="action-btn btn-secondary" bindtap="onCancel">取消订单</view>
    <view wx:if="{{canConfirm}}" class="action-btn btn-primary" bindtap="onConfirmDelivery">确认收货</view>
    <view wx:if="{{canReview}}" class="action-btn btn-primary" bindtap="onReview">去评价</view>
  </view>

</view>
<view wx:else class="loading-wrap">加载中...</view>
