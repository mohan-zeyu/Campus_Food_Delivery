<!--pages/merchant-detail/index.wxml-->
<view class="merchant-detail-page" wx:if="{{!loading}}">

  <!-- å•†å®¶å¤´å›¾ -->
  <image class="cover" src="{{merchant.cover_image}}" mode="aspectFill"/>

  <!-- å•†å®¶ä¿¡æ¯ -->
  <view class="info-card card">
    <view class="name text-xl text-bold">{{merchant.name}}</view>
    <view class="row mt-8">
      <view class="rating">â­ {{merchant.avg_rating}} ({{merchant.rating_count}}è¯„)</view>
      <view class="dot">Â·</view>
      <view class="location text-secondary">{{merchant.location}}</view>
    </view>
    <view class="row mt-8 text-sm text-secondary">
      <view>è¥ä¸š {{merchant.operating_hours.open}}-{{merchant.operating_hours.close}}</view>
      <view class="dot">Â·</view>
      <view>èµ·é€ Â¥{{merchant.min_order/100}}</view>
    </view>
  </view>

  <!-- å•†å“åˆ—è¡¨ -->
  <view class="product-container">
    <!-- å·¦ä¾§åˆ†ç±» -->
    <scroll-view class="category-list" scroll-y>
      <view wx:for="{{categories}}" wx:key="name"
        class="cat-item {{activeCategory === item.name ? 'active' : ''}}"
        data-name="{{item.name}}" bindtap="onCategoryTap">
        {{item.name}}
      </view>
    </scroll-view>

    <!-- å³ä¾§å•†å“ -->
    <scroll-view class="product-list" scroll-y>
      <view wx:for="{{categories}}" wx:key="name"
        wx:if="{{activeCategory === item.name || activeCategory === ''}}">
        <view class="cat-header">{{item.name}}</view>
        <view wx:for="{{item.products}}" wx:for-item="p" wx:key="_id"
          class="product-item" bindtap="onProductTap" data-id="{{p._id}}">
          <image class="product-img" src="{{p.images[0]}}" mode="aspectFill"/>
          <view class="product-info flex-1">
            <view class="product-name">{{p.name}}</view>
            <view class="product-tags">
              <text wx:for="{{p.tags}}" wx:for-item="tag" wx:key="*this" class="tag">{{tag}}</text>
            </view>
            <view class="product-bottom row-between">
              <view class="price">Â¥<text class="price-num">{{p.price/100}}</text></view>
              <view class="add-btn" catchtap="onAddToCart" data-product="{{p}}">+</view>
            </view>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- è´­ç‰©è½¦æ‚¬æµ®æ¡ -->
  <view class="cart-bar" wx:if="{{cartSummary.itemCount > 0}}" bindtap="onGoCart">
    <view class="cart-icon-wrap">
      ğŸ›’
      <view class="cart-badge">{{cartSummary.itemCount}}</view>
    </view>
    <view class="cart-total flex-1">Â¥{{cartSummary.itemsTotal/100}}</view>
    <view class="cart-go">å»ç»“ç®—</view>
  </view>

</view>
<view wx:else class="loading-wrap">åŠ è½½ä¸­...</view>
