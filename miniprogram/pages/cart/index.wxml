<!--pages/cart/index.wxml-->
<view class="cart-page" wx:if="{{cartData && cartData.items.length > 0}}">

  <!-- å•†å®¶åç§° -->
  <view class="merchant-bar row-between card">
    <view class="text-bold">{{cartData.merchant_name}}</view>
    <view class="clear-btn text-secondary text-sm" bindtap="onClearCart">æ¸…ç©º</view>
  </view>

  <!-- å•†å“åˆ—è¡¨ -->
  <view class="cart-items card">
    <view class="cart-item row" wx:for="{{cartData.items}}" wx:key="product_id">
      <image class="item-img" src="{{item.image}}" mode="aspectFill"/>
      <view class="item-info flex-1">
        <view class="item-name">{{item.name}}</view>
        <view class="item-remarks text-secondary text-sm" wx:if="{{item.remarks}}">{{item.remarks}}</view>
        <view class="item-bottom row-between">
          <view class="price">Â¥{{item.unit_price/100}}</view>
          <view class="qty-ctrl row">
            <view class="qty-btn" catchtap="onQuantityChange"
              data-product-id="{{item.product_id}}"
              data-remarks="{{item.remarks}}"
              data-delta="{{-1}}">âˆ’</view>
            <view class="qty-num">{{item.quantity}}</view>
            <view class="qty-btn plus" catchtap="onQuantityChange"
              data-product-id="{{item.product_id}}"
              data-remarks="{{item.remarks}}"
              data-delta="{{1}}">+</view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ”¶è´§åœ°å€ -->
  <view class="address-card card">
    <view class="section-label text-secondary text-sm mb-8">æ”¶è´§åœ°å€</view>
    <view wx:if="{{selectedAddress}}" class="address-info" bindtap="onAddressSelect">
      <view class="addr-label tag">{{selectedAddress.label}}</view>
      <view class="addr-detail">{{selectedAddress.building}} {{selectedAddress.room}}</view>
      <view class="addr-contact text-secondary text-sm">{{selectedAddress.contact}} {{selectedAddress.phone}}</view>
    </view>
    <view wx:else class="add-addr-btn" bindtap="onAddAddress">+ æ·»åŠ æ”¶è´§åœ°å€</view>
  </view>

  <!-- é…é€æ—¶é—´ -->
  <view class="time-card card">
    <view class="section-label text-secondary text-sm mb-8">é…é€æ—¶é—´</view>
    <picker mode="selector" range="{{deliveryTimeOptions}}" bindchange="onDeliveryTimeChange">
      <view class="time-picker row-between">
        <view>{{deliveryTime}}</view>
        <view class="text-secondary">â€º</view>
      </view>
    </picker>
  </view>

  <!-- è´¹ç”¨æ˜ç»† -->
  <view class="fee-card card">
    <view class="fee-row row-between">
      <view class="text-secondary">å•†å“åˆè®¡</view>
      <view>Â¥{{summary.itemsTotal/100}}</view>
    </view>
    <view class="fee-row row-between">
      <view class="text-secondary">åŒ…è£…è´¹</view>
      <view>Â¥{{summary.packagingFee/100}}</view>
    </view>
    <view class="fee-row row-between">
      <view class="text-secondary">é…é€è´¹</view>
      <view>Â¥{{deliveryFee/100}}</view>
    </view>
    <view class="divider mt-16 mb-16"></view>
    <view class="fee-row row-between text-bold">
      <view>åˆè®¡</view>
      <view class="price">Â¥{{(summary.itemsTotal + summary.packagingFee + deliveryFee)/100}}</view>
    </view>
  </view>

  <!-- åº•éƒ¨ç»“ç®— -->
  <view class="checkout-bar">
    <view class="total-info flex-1">
      å…±{{summary.itemCount}}ä»¶ åˆè®¡
      <text class="price text-xl">Â¥{{(summary.itemsTotal + summary.packagingFee + deliveryFee)/100}}</text>
    </view>
    <view class="checkout-btn btn-primary" bindtap="onCheckout">å»ç»“ç®—</view>
  </view>

</view>

<!-- ç©ºè´­ç‰©è½¦ -->
<view wx:else class="empty-cart">
  <view class="empty-icon">ğŸ›’</view>
  <view class="empty-text">è´­ç‰©è½¦ç©ºç©ºå¦‚ä¹Ÿ</view>
  <view class="go-btn btn-primary" bindtap="onGoHome">å»é€›é€›</view>
</view>
